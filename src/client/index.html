<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport"
    content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />
  <title>Devvit Game</title>
  <link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body>
  <canvas class="game-canvas" id="canvas" oncontextmenu="event.preventDefault()" tabindex="-1">
  </canvas>
  <div class="loading" id="loading">
    <div class="splash-container">
      <img src="img/splash.png" alt="Snoo-Clues Splash" class="splash-image" />
    </div>
    <div class="loading-content">
      <div class="spinner" id="spinner"></div>
      <div class="status" id="status">Initializing Game...</div>
      <progress value="0" max="100" id="progress" hidden="1"></progress>
      <div class="detective-briefing">
        <p>üîç Observe 3 clues. Guess the subreddit. Maintain your streak. Good luck, Detective.</p>
      </div>
      <button id="start-investigation-btn" class="start-investigation-btn hidden">
        START INVESTIGATION
      </button>
    </div>
  </div>

  <div class="modal hidden" id="selectionModal">
    <div class="modal-content selection-hub">
      <button class="modal-close-btn" id="closeSelectionModal">&times;</button>
      <div id="user-greeting"></div>
      <h3>Case Selection</h3>
      <p>Choose your investigation mode:</p>
      <div class="selection-options">
        <button class="selection-btn daily-btn" id="startDailyBtn">
          <span class="btn-title">TODAY'S INVESTIGATION</span>
          <span class="btn-subtitle">The 24-hour daily challenge</span>
        </button>
        <button class="selection-btn cold-btn" id="startColdBtn">
          <span class="btn-title">BROWSE COLD CASES</span>
          <span class="btn-subtitle">Unlimited practice files</span>
        </button>
      </div>
      <div class="selection-footer">
        <button id="selectionExitToHome" class="back-btn">‚åÇ Return to Main Menu</button>
      </div>
    </div>
  </div>

  <!-- Snoo-Clues Game Overlay -->
  <div class="game-overlay" id="gameOverlay">
    <div class="game-container">
      <header class="game-header">
        <div class="header-nav">
          <div class="header-left-actions">
            <button id="backToSelection" class="back-btn">‚Üê Case Type</button>
            <button id="exitToHome" class="back-btn">‚åÇ Exit to Home</button>
          </div>
          <div class="header-right-actions">
            <span id="currentModeTag" class="mode-tag daily">DAILY CASE</span>
            <div class="settings-container">
              <button id="settings-btn" class="settings-btn" title="Settings">‚öôÔ∏è</button>
              <div id="settings-panel" class="settings-panel hidden">
                <div class="settings-header">Settings</div>
                <button id="mute-btn" class="mute-btn">üîä Master Mute: Off</button>
                <button id="music-mute-btn" class="mute-btn">üéµ Background Music: On</button>
                <div class="settings-hint">"Master Mute" disables all game audio.</div>
              </div>
            </div>
          </div>
        </div>
        <div class="header-top">
          <div class="header-titles">
            <h1>Snoo-Clues</h1>
            <div class="rank-badge">RANK: <span id="rank-value">Rookie Sleuth</span></div>
          </div>
          <div class="streak-badge">üî• Streak: <span id="streak-value">0</span></div>
        </div>
        <p class="game-subtitle">The Daily Subreddit Investigation</p>
      </header>

      <div class="clues-container">
        <div class="clue-card visible">
          <div class="clue-header">
            <span class="clue-number">Clue #1</span>
          </div>
          <p class="clue-text" id="clue1Text">Loading...</p>
        </div>

        <div class="clue-card locked" id="clue2Card">
          <div class="clue-header">
            <span class="clue-number">Clue #2</span>
            <button class="reveal-btn" id="revealClue2">Show Clue</button>
          </div>
          <p class="clue-text hidden" id="clue2Text">???</p>
        </div>

        <div class="clue-card locked" id="clue3Card">
          <div class="clue-header">
            <span class="clue-number">Clue #3</span>
            <button class="reveal-btn" id="revealClue3">Show Clue</button>
          </div>
          <p class="clue-text hidden" id="clue3Text">???</p>
        </div>
      </div>

      <div class="guess-section">
        <div class="attempts-counter">
          Attempts: <span id="attemptsCount">0</span>
        </div>
        <div class="input-row">
          <span class="r-prefix">r/</span>
          <input type="text" id="guessInput" class="guess-input" placeholder="subreddit name" autocomplete="off" />
          <button class="submit-btn" id="submitBtn">Submit</button>
        </div>
        <p class="feedback-message" id="feedbackMessage"></p>
      </div>

      <div class="leaderboard-section">
        <h3>Top Detectives</h3>
        <div id="leaderboardList" class="leaderboard-list">
          <div class="leaderboard-item loading">Loading rankings...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Win Modal -->
  <div class="modal hidden" id="winModal">
    <div class="modal-content win">
      <button class="modal-close-btn win-close-x">&times;</button>
      <div class="stamp-container">
        <div id="case-closed-stamp" class="case-closed-stamp hidden">CASE CLOSED</div>
      </div>
      <h2>Case Solved!</h2>
      <p>Excellent work, <span id="win-rank-name">Detective</span>. You've identified the community:</p>
      <p id="correct-answer" class="answer-reveal">r/...</p>
      <div class="stats-row">
        <div class="stat-box">
          <div class="stat-value" id="win-attempts-count">0</div>
          <div class="stat-label">Attempts</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="win-streak-val">0</div>
          <div class="stat-label">Streak</div>
        </div>
      </div>
      <div class="modal-actions">
        <button id="share-btn" class="modal-btn share-btn">üì¢ Share to Reddit</button>
        <button id="keep-training-btn" class="modal-btn training-btn">üî• KEEP TRAINING: Open a Cold Case</button>
        <button class="modal-btn secondary close-modal-btn">Close</button>
      </div>
    </div>
  </div>

  <!-- Already Played Modal -->
  <div class="modal hidden" id="playedModal">
    <div class="modal-content">
      <button class="modal-close-btn played-close-x">&times;</button>
      <h2>Already Solved</h2>
      <p>This case is already closed for today. You correctly identified:</p>
      <p id="played-answer" class="answer-reveal">r/...</p>
      <div class="stats-row">
        <div class="stat-box">
          <div class="stat-value" id="played-attempts-count">0</div>
          <div class="stat-label">Attempts</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="played-streak-val">0</div>
          <div class="stat-label">Streak</div>
        </div>
      </div>
      <p class="next-puzzle">Return tomorrow for a new investigation.</p>
      <div class="modal-actions">
        <button class="modal-btn secondary close-modal-btn">View Clues</button>
        <button id="playedToColdBtn" class="modal-btn training-btn">Browse Cold Cases</button>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div class="modal hidden" id="confirmModal">
    <div class="modal-content">
      <h2 id="confirmModalTitle">Abandon Case?</h2>
      <p id="confirmModalText">Abandoning this case will forfeit your current investigation and reset your streak to 0. Retreat?</p>
      <div class="modal-actions">
        <button id="confirm-yes-btn" class="modal-btn">Yes, Abandon</button>
        <button id="confirm-no-btn" class="modal-btn secondary">No, Stay</button>
      </div>
    </div>
  </div>

  <script type="module" src="main.ts" defer></script>
</body>

</html>